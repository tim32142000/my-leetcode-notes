# Bit Manipulation

## 1. 提取/消去最後一個 1 (The Power of Two)

* n & (n - 1)：將最右邊的 1 變成 0。

  * 應用：計算 1 的數量（Hamming Weight）、判斷是否為 2 的冪次方。

* n & -n：只保留最右邊的 1，其餘全部變 0。

  * 原理：在電腦的二進位補數（Two's Complement）系統中，-n 等於 ~n + 1（反轉後加一）。

  * 應用：樹狀數組（Binary Indexed Tree / Fenwick Tree）的核心。

## 2. XOR 的奇蹟特性

`^` (XOR) 是位元運算中最有趣的符號，它的邏輯是「相同為 0，不同為 1」。

* 特性：

  1. x ^ x = 0 (自己跟自己互斥會消失)

  2. x ^ 0 = x (任何數跟 0 互斥保持不變)

  3. 滿足交換律：a ^ b ^ a = (a ^ a) ^ b = 0 ^ b = b

* 經典應用：

  * 找出唯一的數：在一個陣列中，每個數字都出現兩次，只有一個出現一次，請找出來。

  * 解法：把全部數字 XOR 起來，成對的會全部抵消變 0，最後剩下的就是答案。

## 3. 操作特定的位元 (Bitmasking)

如果您想對第 i 位（由右往左，從 0 開始）進行操作：

* 檢查第 i 位是否為 1：(n >> i) & 1 或 n & (1 << i)

* 將第 i 位設為 1：n | (1 << i)

* 將第 i 位設為 0：n & ~(1 << i)

* 翻轉第 i 位：n ^ (1 << i)

## 4. 快速乘除法 (Shifting)

這是編譯器優化最常做的事情：

    乘以 2 的 k 次方：n << k

    除以 2 的 k 次方：n >> k

    優點：位移運算的執行速度通常遠快於普通的乘除法。

## 5. 交換兩個數 (不需要第三個變數)

這是一個很有名的面試考題，雖然在現代開發中不建議使用（降低可讀性），但它展示了 XOR 的威力：

```python
a = a ^ b
b = a ^ b  # 此時 b 變成了原本的 a
a = a ^ b  # 此時 a 變成了原本的 b
```